---
// Testimonials.astro - Safe Passage Stories
// Amplified voices of patients who found shelter
// Anti-AI Constraint: Intentional asymmetry (masonry layout with varied heights)

interface Testimonial {
  rating: number;
  quote: string;
  highlightWords?: string[];
  author: string;
  authorInitials: string;
  context?: string;
  size: 'tall' | 'medium' | 'short';
  bgColor: string;
}

const testimonials: Testimonial[] = [
  {
    rating: 5,
    quote: "After years of feeling rushed through 5-minute appointments elsewhere, Dr. Chen actually listened to my concerns. She took the time to explain my treatment options in detail and never made me feel like I was just another number. The online booking made it so easy—no more phone tag with receptionists. I finally found a practice that treats me like a person.",
    highlightWords: ["rushed", "listened"],
    author: "Jennifer K.",
    authorInitials: "JK",
    context: "Patient since 2021",
    size: 'tall',
    bgColor: 'bg-white'
  },
  {
    rating: 5,
    quote: "Being able to speak in Mandarin with Dr. Chen made all the difference. I could explain my symptoms without struggling for words.",
    author: "Mary L.",
    authorInitials: "ML",
    context: "Google Review",
    size: 'medium',
    bgColor: 'bg-blue-50'
  },
  {
    rating: 5,
    quote: "No more weeks of waiting. Booked online at midnight, had an appointment the next week. Game changer.",
    author: "David R.",
    authorInitials: "DR",
    size: 'short',
    bgColor: 'bg-white'
  },
  {
    rating: 5,
    quote: "Dr. Patel's approach to men's health is compassionate and non-judgmental. He took the time to understand my concerns.",
    highlightWords: ["compassionate", "non-judgmental"],
    author: "Paul T.",
    authorInitials: "PT",
    context: "Patient since 2023",
    size: 'medium',
    bgColor: 'bg-white'
  },
  {
    rating: 5,
    quote: "As someone managing diabetes, having a GP who provides ongoing support rather than one-off consultations has been life-changing. The practice coordinates my specialist appointments, explains my test results clearly, and genuinely cares about my long-term health. Plus, the transparent pricing means no billing surprises.",
    highlightWords: ["ongoing support"],
    author: "Robert S.",
    authorInitials: "RS",
    context: "Patient since 2019",
    size: 'tall',
    bgColor: 'bg-orange-50'
  },
  {
    rating: 5,
    quote: "Finally, a practice that respects my time and treats me like a person, not a number.",
    author: "Lisa M.",
    authorInitials: "LM",
    size: 'short',
    bgColor: 'bg-blue-50'
  }
];

// Helper function to highlight keywords
function highlightKeywords(quote: string, keywords: string[] = []): string {
  let highlighted = quote;
  keywords.forEach(keyword => {
    const regex = new RegExp(`(${keyword})`, 'gi');
    highlighted = highlighted.replace(regex, '<span class="text-orange-400 font-semibold">$1</span>');
  });
  return highlighted;
}
---

<section class="py-24 bg-stone-50">
  <div class="container mx-auto px-6">
    <h2 class="text-4xl md:text-5xl font-bold text-blue-900 mb-4 text-center">
      Safe Passage Stories
    </h2>
    <p class="text-xl text-stone-600 text-center mb-16">
      Hear from patients who found their safe harbour with us
    </p>

    <!-- Masonry layout with varied heights (intentional asymmetry) -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-7xl mx-auto">
      {testimonials.map(testimonial => (
        <div class={`${testimonial.bgColor} p-${testimonial.size === 'tall' ? '8' : '6'} rounded-3xl shadow-lg ${testimonial.size === 'tall' ? 'row-span-2' : ''}`}>
          <!-- Star rating -->
          <div class="flex gap-1 mb-4">
            <span class={`text-orange-400 ${testimonial.size === 'tall' ? 'text-xl' : ''}`}>
              {'★'.repeat(testimonial.rating)}
            </span>
          </div>

          <!-- Quote with highlighted emotional keywords -->
          <p class={`text-stone-700 leading-relaxed mb-${testimonial.size === 'tall' ? '6' : '4'} ${testimonial.size === 'tall' ? 'text-lg' : ''}`} set:html={highlightKeywords(testimonial.quote, testimonial.highlightWords)} />

          <!-- Author -->
          {testimonial.authorInitials && (
            <div class="flex items-center gap-3">
              <div class={`w-${testimonial.size === 'tall' ? '12' : '10'} h-${testimonial.size === 'tall' ? '12' : '10'} bg-blue-100 rounded-full flex items-center justify-center text-blue-900 font-bold ${testimonial.size === 'short' ? 'text-sm' : ''}`}>
                {testimonial.authorInitials}
              </div>
              <div>
                <p class={`font-semibold text-stone-900 ${testimonial.size === 'short' ? 'text-sm' : ''}`}>
                  {testimonial.author}
                </p>
                {testimonial.context && (
                  <p class={`text-stone-500 ${testimonial.size === 'short' ? 'text-xs' : 'text-sm'}`}>
                    {testimonial.context}
                  </p>
                )}
              </div>
            </div>
          )}
          {!testimonial.authorInitials && (
            <p class={`font-semibold text-stone-900 ${testimonial.size === 'short' ? 'text-sm' : ''}`}>
              {testimonial.author}
            </p>
          )}
        </div>
      ))}
    </div>

    <!-- Google Reviews CTA -->
    <div class="text-center mt-12">
      <p class="text-stone-600 mb-4">Rated 4.9/5 from 200+ Google Reviews</p>
      <a
        href="https://google.com/reviews/harbourview"
        target="_blank"
        class="inline-flex items-center gap-2 text-orange-400 font-semibold hover:text-orange-500"
      >
        Read all reviews on Google →
      </a>
    </div>
  </div>
</section>
