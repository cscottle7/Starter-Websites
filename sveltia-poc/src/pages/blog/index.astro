---
import { getCollection } from 'astro:content';

// Fetch all blog posts
const blogPosts = await getCollection('blog');
// Sort by publish date (newest first)
const sortedPosts = blogPosts.sort(
  (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
);
---

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Blog Posts - Sveltia CMS POC</title>
		<style>
			body {
				font-family: system-ui, -apple-system, sans-serif;
				max-width: 800px;
				margin: 0 auto;
				padding: 2rem;
				line-height: 1.6;
			}
			h1 { color: #2563eb; }
			.post {
				border: 1px solid #e5e7eb;
				padding: 1.5rem;
				margin-bottom: 1.5rem;
				border-radius: 0.5rem;
			}
			.post h2 { margin-top: 0; }
			.meta {
				color: #6b7280;
				font-size: 0.875rem;
			}
			.tags {
				display: flex;
				gap: 0.5rem;
				margin-top: 0.5rem;
			}
			.tag {
				background: #dbeafe;
				padding: 0.25rem 0.5rem;
				border-radius: 0.25rem;
				font-size: 0.75rem;
			}
		</style>
	</head>
	<body>
		<h1>Blog Posts</h1>
		<p><a href="/">← Back to Home</a> | <a href="/admin">Open CMS Admin →</a></p>

		{sortedPosts.length === 0 ? (
			<p>No blog posts yet. Create one via the <a href="/admin">CMS admin panel</a>!</p>
		) : (
			sortedPosts.map(post => (
				<article class="post">
					<h2><a href={`/blog/${post.slug}`}>{post.data.title}</a></h2>
					<p>{post.data.description}</p>
					<div class="meta">
						By {post.data.author} on {post.data.publishDate.toLocaleDateString()}
					</div>
					<div class="tags">
						{post.data.tags.map(tag => (
							<span class="tag">{tag}</span>
						))}
					</div>
				</article>
			))
		)}
	</body>
</html>
